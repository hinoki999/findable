# Railway Environment Variables Setup

## ⚠️ IMPORTANT: Add JWT Secret to Railway

Your backend has been updated to use environment variables, but **you must add the JWT secret to Railway** or authentication will fail.

---

## Step-by-Step Railway Setup

### 1. Generate Production JWT Secret

Run this command to generate a **NEW** secure key for production:

```bash
cd backend
python generate_secret_key.py
```

**Copy the generated key** - you'll need it for step 2.

### 2. Add to Railway Environment Variables

1. Go to [Railway Dashboard](https://railway.app)
2. Select your project: **findable**
3. Click on **backend** service
4. Click **"Variables"** tab
5. Add the following environment variables:

```
JWT_SECRET_KEY=<paste-your-generated-key-here>
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_DAYS=30
```

### 3. (Optional) Add Other Services

If you're using SendGrid for emails:

```
SENDGRID_API_KEY=<your-sendgrid-api-key>
FROM_EMAIL=noreply@yourdomain.com
```

If you're using Cloudinary for profile photos:

```
CLOUDINARY_CLOUD_NAME=<your-cloud-name>
CLOUDINARY_API_KEY=<your-api-key>
CLOUDINARY_API_SECRET=<your-api-secret>
```

### 4. Save & Deploy

Click **"Add"** or **"Save"** - Railway will automatically redeploy with the new environment variables.

---

## Verification

### Check Deployment Logs

After Railway redeploys, check the logs:

**✅ SUCCESS - You should see:**
```
✓ Using PostgreSQL database (Railway)
✓ Server started successfully
```

**❌ WARNING - You should NOT see:**
```
⚠️  WARNING: Using default JWT_SECRET_KEY! Set JWT_SECRET_KEY environment variable in production.
```

If you see the warning, the JWT_SECRET_KEY wasn't set correctly in Railway.

### Test Authentication

Try logging in through your mobile app. If authentication works, environment variables are configured correctly.

---

## Local Development Setup

For local testing, create a `.env` file:

```bash
cd backend
cp .env.example .env
```

Edit `.env` and add a **DIFFERENT** JWT secret (not the same as production):

```bash
# Generate a LOCAL dev key
python generate_secret_key.py

# Add to .env file:
JWT_SECRET_KEY=<paste-dev-key-here>
```

---

## Security Notes

### ✅ DO

- **Use different JWT secrets** for development and production
- **Keep secrets private** - never commit or share
- **Rotate secrets periodically** (every 90 days)
- **Use strong random keys** (generated by script)

### ❌ DON'T

- **Never commit `.env` file** (already in .gitignore)
- **Never use default secret** in production
- **Never reuse secrets** across environments
- **Never share secrets** in chat, email, or public repos

---

## Troubleshooting

### Issue: "JWT decode error" or "Invalid token"

**Cause:** JWT_SECRET_KEY not set in Railway or changed after users logged in

**Fix:**
1. Add JWT_SECRET_KEY to Railway variables
2. All users must log in again (old tokens invalid)

### Issue: "Using default JWT_SECRET_KEY" warning in logs

**Cause:** JWT_SECRET_KEY environment variable not set

**Fix:**
1. Generate key: `python generate_secret_key.py`
2. Add to Railway Variables tab
3. Wait for automatic redeploy

### Issue: Backend won't start after adding variables

**Cause:** Invalid environment variable format or syntax

**Fix:**
1. Check Railway logs for error messages
2. Ensure no quotes around values in Railway variables
3. Ensure variable names are exact (case-sensitive)

---

## Quick Reference

| Environment | JWT Secret Location | Database |
|-------------|---------------------|----------|
| **Local Development** | `backend/.env` file | SQLite (`droplink.db`) |
| **Railway Production** | Railway Variables tab | PostgreSQL (auto-configured) |

---

## Next Steps

1. ✅ Generate production JWT secret: `python generate_secret_key.py`
2. ✅ Add to Railway Variables tab
3. ✅ Wait for automatic redeploy (~60 seconds)
4. ✅ Verify no warnings in Railway logs
5. ✅ Test authentication in mobile app

---

**Need Help?**

- See `ENVIRONMENT_VARIABLES.md` for detailed documentation
- Check Railway deployment logs for error messages
- Ensure all variable names match exactly (case-sensitive)

---

**Status:** ⚠️ **ACTION REQUIRED** - Add JWT_SECRET_KEY to Railway

